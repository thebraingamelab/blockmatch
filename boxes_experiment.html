<!DOCTYPE html>
<html>
    <head>
        <title>My Experiment</title>
        <script src="jspsych-6.0.4/jspsych.js"></script>
        <script src="jspsych-6.0.4/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-boxes.js"></script>
        <script src="jspsych-6.0.4/plugins/jspsych-image-keyboard-response.js"></script>
        <link href="jspsych-6.0.4/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        <style>
        html, body, #experiment {
          margin: 0;
          width: 100%;
          height: 100%
        }

        #progress{
          height: 120px;
          width: 600px;
          border: 1px solid black;
          position: fixed;
          background-color: darkcyan;
          bottom: 0;
          left: calc(50% - 300px);
          font-size: 18px;
          text-decoration: underline;
          text-align: center;
        }

        .circle_1{
          height: 50px;
          width: 50px;
          background-color: #cccccc;
          border: 1px solid black;
          border-radius: 50%;
          display: inline-block;
          position: absolute;
          bottom: 25px;
          left: 125px;
        }

        .circle_2{
          height: 50px;
          width: 50px;
          background-color: #cccccc;
          border: 1px solid black;
          border-radius: 50%;
          display: inline-block;
          position: absolute;
          bottom: 25px;
          left: 200px;
        }
        .circle_3{
          height: 50px;
          width: 50px;
          background-color: #cccccc;
          border: 1px solid black;
          border-radius: 50%;
          display: inline-block;
          position: absolute;
          bottom: 25px;
          left: 275px;
        }
        .circle_4{
          height: 50px;
          width: 50px;
          background-color: #cccccc;
          border: 1px solid black;
          border-radius: 50%;
          display: inline-block;
          position: absolute;
          bottom: 25px;
          left: 350px;
        }
        .circle_5{
          height: 50px;
          width: 50px;
          background-color: #cccccc;
          border: 1px solid black;
          border-radius: 50%;
          display: inline-block;
          position: absolute;
          bottom: 25px;
          left: 425px;
        }
        </style>
      </head>
      <body>
        <div id="experiment"></div>
        <div id="progress"><b>Progress Bar: Round</b>
        <span class= "circle_1"></span>
        <span class= "circle_2"></span>
        <span class= "circle_3"></span>
        <span class= "circle_4"></span>
        <span class= "circle_5"></span>
      </div>
      </body>
      <script>

      var timeline = [];

      var number_of_rounds = 4;

      var correct_responses_per_round = 3;

      var shape = jsPsych.plugins["boxes"].generateFullShape(4,4,8);

      var trials = [
        {reflected:true, orientation: 30, correct_key: 'n'},
        {reflected:true, orientation: 60, correct_key: 'n'},
        {reflected:true, orientation: 90, correct_key: 'n'},
        {reflected:true, orientation: 120, correct_key: 'n'},
        {reflected:true, orientation: 150, correct_key: 'n'},
        {reflected:true, orientation: 180, correct_key: 'n'},
        {reflected:false, orientation: 30, correct_key: 'y'},
        {reflected:false, orientation: 60, correct_key: 'y'},
        {reflected:false, orientation: 90, correct_key: 'y'},
        {reflected:false, orientation: 120, correct_key: 'y'},
        {reflected:false, orientation: 150, correct_key: 'y'},
        {reflected:false, orientation: 180, correct_key: 'y'},
      ]

      var both_new = true
      var box_trial_1 = {
          type: 'boxes',
          grid_rows: 4,
          grid_cols: 4,
          filled_in_reference: function() {return shape},
          both_new: function() {return both_new},
          clearboth: function () {return correct_response==correct_responses_per_round-1},
          square_size: 50,
          rotation_reference: 0,
          reflected:jsPsych.timelineVariable("reflected"),
          rotation_target: jsPsych.timelineVariable("orientation"),
          correct_match: jsPsych.timelineVariable("correct_key"),
          on_finish: function(){
            both_new = false
          }

      };
      // create variable for number of correct responses
      correct_response = 0

      rounds_completed= 0


      var box_trials = {
        timeline: [box_trial_1],
        timeline_variables: trials,
        sample: {
          type: 'without-replacement',
          size: 1
        },

        loop_function: function(data){

          if (data.values()[0].correct){
            correct_response++
          }
          console.log(data.values()[0].correct);
          if (correct_response < correct_responses_per_round) {
            return true
          } else {
            rounds_completed++
            if(rounds_completed < number_of_rounds){
              shape = jsPsych.plugins["boxes"].generateFullShape(4,4,8)
              correct_response = 0
              both_new = true
              return true
            } else {
              return false
            }
            }
        }
      }

      timeline.push(box_trials);
      //var shape = create_shape(4,4,10);
      //var reflected_shape = reflect(shape);



      jsPsych.init({
        timeline: timeline,
        display_element: 'experiment'
      });
      </script>
</html>
