<!DOCTYPE html>
<html>
    <head>
        <title>My Experiment</title>
        <script src="jspsych-6.0.4/jspsych.js"></script>
        <script src="jspsych-6.0.4/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-boxes.js"></script>
        <script src="jspsych-6.0.4/plugins/jspsych-image-keyboard-response.js"></script>
        <link href="jspsych-6.0.4/css/jspsych.css" rel="stylesheet" type="text/css"></link>
      </head>
      <body></body>
      <script>

      var timeline = [];

      var shape = jsPsych.plugins["boxes"].generateShape(4,4,8)

      var trials = [
        {reflected:true, orientation: 30, correct_key: 'n'},
        {reflected:true, orientation: 60, correct_key: 'n'},
        {reflected:true, orientation: 90, correct_key: 'n'},
        {reflected:true, orientation: 120, correct_key: 'n'},
        {reflected:true, orientation: 150, correct_key: 'n'},
        {reflected:true, orientation: 180, correct_key: 'n'},
        {reflected:false, orientation: 30, correct_key: 'y'},
        {reflected:false, orientation: 60, correct_key: 'y'},
        {reflected:false, orientation: 90, correct_key: 'y'},
        {reflected:false, orientation: 120, correct_key: 'y'},
        {reflected:false, orientation: 150, correct_key: 'y'},
        {reflected:false, orientation: 180, correct_key: 'y'},
      ]

      var box_trial_1 = {
          type: 'boxes',
          grid_rows: 4,
          grid_cols: 4,
          filled_in_reference: shape,
          both_new: false,
          clearboth: false,
          square_size: 50,
          rotation_reference: 0,
          reflected:jsPsych.timelineVariable("reflected"),
          rotation_target: jsPsych.timelineVariable("orientation"),
          correct_match: jsPsych.timelineVariable("correct_key"),

      };
      // create variable for number of correct responses

      var box_trials = {
        timeline: [box_trial_1],
        timeline_variables: trials,
        sample: {
          type: 'without-replacement',
          size: 1
        },

        loop_function: function(data){
          console.log(data.values()[0].correct);
          return true; // to continue ( < 5 correct)
          //return false; // if they are done (5 correct)
        }
      }

      timeline.push(box_trials);
      //var shape = create_shape(4,4,10);
      //var reflected_shape = reflect(shape);

      var box_trial_2 = {
          type: 'boxes',
          grid_rows: 4,
          grid_cols: 4,
          filled_in_reference: [
            [false, false, false, true],
            [false, false, true, false],
            [false, false, true, false],
            [false, true, false, false]
          ],
          both_new: false,
          square_size: 50,
          rotation_reference: 0,
          filled_in_target: [
            [false, false, false, true],
            [false, false, true, false],
            [false, false, true, false],
            [false, true, false, false]
          ],
          rotation_target: 0,
          correct_match: 'y',
        };
        timeline.push(box_trial_2);

      jsPsych.init({
        timeline: timeline
      });
      </script>
</html>
