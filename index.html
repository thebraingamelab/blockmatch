<!DOCTYPE html>
<html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>My Experiment</title>
        <script src="jspsych-6.0.4/jspsych.js"></script>
        <script src="jspsych-6.0.4/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-boxes.js"></script>
        <script src="jspsych-6.0.4/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="jspsych-6.0.4/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-6.0.4/plugins/jspsych-survey-multi-choice.js"></script>
        <script src="jspsych-6.0.4/plugins/jspsych-survey-text.js"></script>
        <script src="jspsych-6.0.4/plugins/jspsych-survey-multi-select.js"></script>
        <link href="jspsych-6.0.4/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        <link href="https://fonts.googleapis.com/css?family=Overpass" rel="stylesheet">
        <style>
        html, body, #experiment {
          margin: 0;
          width: 100%;
          height: 100%;
        }

        body{
          background-color: white;
        }

        #progress{
          height: 120px;
          width: 600px;
          border: 1px solid black;
          position: fixed;
          background-color: darkcyan;
          bottom: 0;
          left: calc(50% - 300px);
          visibility: hidden;
        }
         .text{
           font-size: 18px;
           text-align: center;
           font-weight: bold;
         }
        .circle{
          height: 50px;
          width: 50px;
          background-color: #cccccc;
          border: 1px solid black;
          border-radius: 50%;
          display: inline-block;
          margin: 10px;
        }

        </style>
      </head>
      <body>
        <div id="experiment"></div>
        <div id="progress" class="text">
          <b>Progress Bar: </b>
        <span id= "round" class= "text">  </span>
        <span id= "total" class= "text">  </span>
        <div id= "circle_container"></div>
      </div>
      </body>
      <script>

      var timeline = [];

      var welcome ={
        type: 'html-button-response',
        stimulus: "<p> This is a research project conducted at Vassar College. " +
        "In this experiment you will play a</p><p>computer game that is "+
        "designed to measure aspects of your cognition; such as attention, "+
        "memory,</p><p>and learning. We will record data about how you play, "+
        "such as what keys you pressed or where</p><p>you clicked. The "+
        "experiment will take approximately [X] minutes to complete. You will "+
        "recieve</p><p>a payment of [$X] upon completion of the experiment. "+
        "The data we collect will be used for</p><p>research purposes. We do "+
        "not collect any personally identifying information, so your data is"+
        "</p><p>anonymous. You are free to stop the experiment by closing "+
        "your browser window at any time. If</p><p>you have any questions, you "+
        "can contact the researchers through Prolific's messaging system.</p>"+
        "<p></p><p> By clicking 'I agree', you affirm that you are at least "+
        "18 years of age, which is the minimum age</p><p>to participate in "+
        "this study, and that you understand the nature of your participation "+
        "in this</p><p>research. If you do not wish to participate, please "+
        "close this window.</p>",
        choices: ["I agree"],
        button_html: '<button class="jspsych-btn">%choice%</button>',
      };
      //timeline.push(welcome);


    var  box_trial_same_or_mirror_1 = {
          type: 'boxes',
          grid_rows: 4,
          grid_cols: 4,
          filled_in_reference: [
          [false, false, true, true],
          [false, false, true, false],
          [false, true, false, false],
          [false, true, false, false]
          ],
          both_new: true,
          clearboth: false,
          square_size: 50,
          rotation_reference: 0,
          reflected: true,
          rotation_target: 0,
          correct_match: 'n',
          dialog: ["<p><b>Welcome!</b></p> <p>For this experiment, you will only be using the <b>'N'</b> and <b>'Y'</b> keys. </p>",
          "<p>For this game, your task will be to determine whether the shape on the <b>right</b> is the <b>same or a mirror image</b> of the shape on the <b>left</b>.</p> ",
          "<p>If the shapes are the <b>same</b>, press the <b>'Y'</b> key. If they are <b>mirror images</b>, press the <b>'N'</b> key.</p> "],
        };
          //timeline.push(box_trial_same_or_mirror_1);

          var  box_trial_same_or_mirror_2= {
                type: 'boxes',
                grid_rows: 4,
                grid_cols: 4,
                filled_in_reference: [
                [false, false, true, true],
                [false, false, true, false],
                [false, true, false, false],
                [false, true, false, false]
                ],
                both_new: true,
                clearboth: false,
                square_size: 50,
                rotation_reference: 0,
                reflected: false,
                rotation_target: 0,
                correct_match: 'y',
      };
      //timeline.push(box_trial_same_or_mirror_2);

      var box_trial_rotate_1 = {
          type: 'boxes',
          grid_rows: 4,
          grid_cols: 4,
          filled_in_reference: [
          [false, false, true, true],
          [false, false, false, true],
          [false, false, true, false],
          [true, true, false, false]
          ],
          both_new: true,
          clearboth: false,
          square_size: 50,
          rotation_reference: 0,
          reflected: true,
          rotation_target: 90,
          correct_match: 'n',
          dialog: ["<p> The shape on the right will now be shown at different angles to challenge you. "+
          "Is the shape on the right the same as the shape on the left?</p> "],
      };
      //timeline.push(box_trial_rotate_1);

      var box_trial_rotate_2 = {
          type: 'boxes',
          grid_rows: 4,
          grid_cols: 4,
          filled_in_reference: [
          [false, false, true, true],
          [false, false, false, true],
          [false, false, true, false],
          [true, true, false, false]
          ],
          both_new: true,
          clearboth: false,
          square_size: 50,
          rotation_reference: 0,
          reflected: false,
          rotation_target: 180,
          correct_match: 'y',
          dialog: ["<p> Is the shape on the right the same as the shape on the left? </p>"],

      };
      //timeline.push(box_trial_rotate_2);

      var box_trial_tutorial_1 = {
          type: 'boxes',
          grid_rows: 4,
          grid_cols: 4,
          filled_in_reference: [
          [false, false, false, true],
          [false, false, false, true],
          [false, true, true, true],
          [true, true, false, false]
          ],
          both_new: true,
          clearboth: false,
          square_size: 50,
          rotation_reference: 0,
          reflected: false,
          rotation_target: 180,
          correct_match: 'y',
          dialog: ["<p>Now try some on your own!</p>"],

      };
      //timeline.push(box_trial_tutorial_1);

      var box_trial_tutorial_2 = {
          type: 'boxes',
          grid_rows: 4,
          grid_cols: 4,
          filled_in_reference: [
          [false, false, true, true],
          [false, false, false, true],
          [false, true, true, false],
          [false, true, false, false]
          ],
          both_new: true,
          clearboth: false,
          square_size: 50,
          rotation_reference: 0,
          reflected: false,
          rotation_target: 60,
          correct_match: 'y',
      };
      //timeline.push(box_trial_tutorial_2);

      var box_trial_tutorial_3 = {
          type: 'boxes',
          grid_rows: 4,
          grid_cols: 4,
          filled_in_reference: [
          [false, false, true, true],
          [false, false, false, true],
          [false, true, true, false],
          [false, true, false, false]
          ],
          both_new: true,
          clearboth: false,
          square_size: 50,
          rotation_reference: 0,
          reflected: true,
          rotation_target: 30,
          correct_match: 'n',
      };
      //timeline.push(box_trial_tutorial_3);

      var congrats ={
        type: "html-button-response",
        stimulus: "Congratulations! You are now ready to continue onto the experiment!",
        choices: ["Continue"],
        button_html: '<button class="jspsych-btn">%choice%</button>',
        on_finish: function(){
          document.querySelector('#progress').style.visibility= "visible"
      },
    };
      //timeline.push(congrats);

      var number_of_rounds = 3;

      var correct_responses_per_round = 3;

      var circle_html= ""

      for(i=0; i < correct_responses_per_round; i++){
        circle_html+= "<span class= 'circle'></span>"

      }
      document.querySelector('#circle_container').innerHTML= circle_html;

      var shape = jsPsych.plugins["boxes"].generateFullShape(4,4,8);

      var trials = [
        {reflected:true, orientation: 30, correct_key: 'n'},
        {reflected:true, orientation: 60, correct_key: 'n'},
        {reflected:true, orientation: 90, correct_key: 'n'},
        {reflected:true, orientation: 120, correct_key: 'n'},
        {reflected:true, orientation: 150, correct_key: 'n'},
        {reflected:true, orientation: 180, correct_key: 'n'},
        {reflected:false, orientation: 30, correct_key: 'y'},
        {reflected:false, orientation: 60, correct_key: 'y'},
        {reflected:false, orientation: 90, correct_key: 'y'},
        {reflected:false, orientation: 120, correct_key: 'y'},
        {reflected:false, orientation: 150, correct_key: 'y'},
        {reflected:false, orientation: 180, correct_key: 'y'},
      ]

      var both_new = true
      var box_trial_1 = {
          type: 'boxes',
          grid_rows: 4,
          grid_cols: 4,
          filled_in_reference: function() {return shape},
          both_new: function() {return both_new},
          clearboth: function () {return correct_response==correct_responses_per_round - 1},
          square_size: 50,
          rotation_reference: 0,
          reflected:jsPsych.timelineVariable("reflected"),
          rotation_target: jsPsych.timelineVariable("orientation"),
          correct_match: jsPsych.timelineVariable("correct_key"),
          on_finish: function(){
            both_new = false
          }

      };
      // create variable for number of correct responses
      correct_response = 0

      rounds_completed= 0

      document.querySelector('#round').innerHTML = "Round "+(rounds_completed+1)+" "
      document.querySelector('#total').innerHTML = "of "+number_of_rounds+" "

      var box_trials = {
        timeline: [box_trial_1],
        timeline_variables: trials,
        sample: {
          type: 'without-replacement',
          size: 1
        },

        loop_function: function(data){

          if (data.values()[0].correct){
            correct_response++
          }
          console.log(data.values()[0].correct);
          if (correct_response < correct_responses_per_round) {
          var matches=  document.querySelectorAll('.circle')
              for(i=0; i < matches.length; i++){
                if(i < correct_response){
                  matches[i].style="background-color: purple"
                }
              }
            return true
          } else {
            rounds_completed++
            if(rounds_completed < number_of_rounds){
              document.querySelector('#round').innerHTML = "Round "+(rounds_completed+1)+" "
              document.querySelector('#total').innerHTML = "of "+number_of_rounds+" "
              shape = jsPsych.plugins["boxes"].generateFullShape(4,4,8)
              correct_response = 0
              both_new = true
              var matches=  document.querySelectorAll('.circle')
                  for(i=0; i < matches.length; i++){
                    // if(i > correct_response){
                      matches[i].style="background-color: #cccccc"
                  }
              return true
            } else {
              document.querySelector('#progress').remove()
              return false
            }
            }
        }
      }

      timeline.push(box_trials);

     var survey1 ={
         type: 'survey-text',
         questions:[{prompt:"<p>What is your age?</p>"},
         {prompt:"<p>What is your gender?</p>"},{prompt:"<p>In the past week, how"+
       " many hours have you played video games of any kind?</p>"}]
        };
     timeline.push(survey1);

     var survey2 ={
       type: 'survey-multi-select',
       questions:[{prompt:"<p>Which of the following platform(s) have you played games on in the past week?</p>",
       options:['Mobile','Desktop/Laptop Web Browser', 'Facebook'],
       horizontal: true}]
        };
     timeline.push(survey2);

     var survey3 ={
         type: 'survey-multi-choice',
         questions: [{prompt: "<p> if this game were available for free, how likely would you be to play it again?</p>",
         options:['Would not play again', 'Not sure', 'Would play again'], horizontal: true},
         {prompt:"<p>if you could see how your scores compare to those around the world, would that motivate you to play it?</p>",
         options:['would not motivate me','Not sure','Would motivate me'], horizontal: true},
         {prompt:"<p>If you could see how your scores compare to people similar to you (similar age and/or location), would that motivate you to play it?</p>",
         options:['would not motivate me','Not sure','Would motivate me'], horizontal: true},
         {prompt:"<p>If you could see how your scores change over time to track your improvement, would that motivate you to play it?</p>",
         options:['would not motivate me','Not sure','Would motivate me'], horizontal: true}]
         };
    timeline.push(survey3);

    var survey4 ={
        type: 'survey-text',
        questions:[{prompt:"<p>Is there any other feedback you would like to give? (Aspects of the game that you did or did not like, parts of the instructions that were confusing, technical problems, or anything else that you’d like to share).</p>",
         ows: 4}, {prompt: "<p>Did you notice any bugs/glitches?</p>", rows:4}]
       };
   timeline.push(survey4);

   var payment ={
     type: 'html-keyboard-response',
     stimulus: "<p>Here is your payment</p>",
     choices: jsPsych.NO_KEYS
   };
   timeline.push(payment);

      jsPsych.init({
        timeline: timeline,
        display_element: 'experiment'
      });
      </script>
</html>
